(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{324:function(t,a,s){t.exports=s.p+"assets/img/eureka-client.3e26dc9a.jpg"},339:function(t,a,s){"use strict";s.r(a);var n=s(4),e=function(t){t.options.__data__block__={mermaid_64a56fb0:'---\ntitle: 客户端负载均衡\n---\nflowchart LR\n\tC1(["调用方(ribbon)"])\n\tE[eureka]\n\tsubgraph S[服务方]\n\t\tS1[服务方1]\n\t\tS2[服务方2]\n\t\tS3[服务方3]\n\tend\n\tC1--\x3e|1.访问|E\n\tE--\x3e|2.返回服务列表|C1\n\tC1--\x3e|3.负载策略选择一个服务|S\n',mermaid_64a56fae:'---\ntitle: 服务端负载均衡\n---\nflowchart LR\n\tC1(["调用方1"])\n\tC2(["调用方2"])\n\tC3(["调用方3"])\n\tN[nginx]\n\tS1[服务方1]\n\tS2[服务方2]\n\tS3[服务方3]\n\tC1 & C2 & C3 --\x3e N\n\tN --\x3e S1 & S2 & S3\n'}},r=Object(n.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"spring-cloud尝试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-cloud尝试"}},[t._v("#")]),t._v(" Spring Cloud尝试")]),t._v(" "),a("p",[t._v("因为Spring Cloud "),a("code",[t._v("2022.0.4")]),t._v("版本需要依赖Spring Boot"),a("code",[t._v("3.0.9")]),t._v("，而目前更多使用的是Spring Boot 2.x版本")]),t._v(" "),a("p",[t._v("所以这里Spring Cloud版本选用"),a("code",[t._v("2021.0.8")]),t._v("，相对应的跟据官方文档，Spring Boot版本选用"),a("code",[t._v("2.6.15")]),t._v("，")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("这里Spring Cloud版本号有个命名变更，之前是使用A-Z的伦敦地铁站命名如："),a("code",[t._v("Hoxton.SR1")]),t._v("，而从2020年开始命名改为日期格式如："),a("code",[t._v("2020.0.0-M1")])])]),t._v(" "),a("h2",{attrs:{id:"一、概念理解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、概念理解"}},[t._v("#")]),t._v(" 一、概念理解")]),t._v(" "),a("p",[t._v("接触一个新东西就得先理解他的相关概念，然后才能找到门道")]),t._v(" "),a("h3",{attrs:{id:"_1-1-什么是spring-cloud"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-什么是spring-cloud"}},[t._v("#")]),t._v(" 1.1 什么是Spring Cloud")]),t._v(" "),a("p",[t._v("首先通过Spring文档，可以看到Spring Cloud有很多子模块。如：Spring Cloud Alibaba、Spring Cloud Config、Spring Cloud Netflix等等。这些到底是什么？和Spring Cloud又有什么关系？")]),t._v(" "),a("p",[t._v("通过百度百科了解到：")]),t._v(" "),a("p",[t._v("Spring Cloud是一系列框架的有序集合。它利用Spring Boot的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务发现注册、配置中心、消息总线、负载均衡、断路器、数据监控等，都可以用Spring Boot的开发风格做到一键启动和部署。Spring Cloud并没有重复制造轮子，它只是将各家公司开发的比较成熟、经得起实际考验的服务框架组合起来，通过Spring Boot风格进行再封装屏蔽掉了复杂的配置和实现原理，最终给开发者留出了一套简单易懂、易部署和易维护的分布式系统开发工具包。")]),t._v(" "),a("p",[t._v("也就是说，这些子模块其实就是将优秀的开源框架结构Spring Boot形成的，这些子模块功能各异，并不是说要全部都用上")]),t._v(" "),a("p",[t._v("了解到这么多模块中Spring Cloud Netflix是最常见的一套，因此先从这个模块入手")]),t._v(" "),a("h3",{attrs:{id:"_1-2-什么是spring-cloud-netflix"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-什么是spring-cloud-netflix"}},[t._v("#")]),t._v(" 1.2 什么是Spring Cloud Netflix")]),t._v(" "),a("p",[t._v("官方文档中描述到：")]),t._v(" "),a("p",[t._v("该项目通过自动配置和绑定到Spring环境和其他Spring编程模型习惯用法，为Spring Boot应用程序提供Netflix的OSS集成。通过一些简单的注释，您可以快速启用和配置应用程序中的常见模式，并使用久经考验的Netflix组件构建大型分布式系统。")]),t._v(" "),a("p",[t._v("在博客"),a("a",{attrs:{href:"https://blog.csdn.net/qq_44112474/article/details/109050543",target:"_blank",rel:"noopener noreferrer"}},[t._v("5.Spring Cloud快速入门-CSDN博客"),a("OutboundLink")],1),t._v("中了解到：")]),t._v(" "),a("p",[t._v("Netflix：微服务大规模的应用，在技术上毫无保留的把一整套微服务架构核心技术栈开源了出来，叫做Netflix OSS")]),t._v(" "),a("ul",[a("li",[t._v("Eureka：注册中心")]),t._v(" "),a("li",[t._v("Zuul：服务网关")]),t._v(" "),a("li",[t._v("Ribbon：负载均衡")]),t._v(" "),a("li",[t._v("Feign：服务调用")]),t._v(" "),a("li",[t._v("Hystix：熔断")])]),t._v(" "),a("h3",{attrs:{id:"_1-3-踩坑了"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-踩坑了"}},[t._v("#")]),t._v(" 1.3 踩坑了")]),t._v(" "),a("p",[t._v("最初的想法是通过官方文档来学习，但因为不了解cloud的结构和设计，看起来觉得很乱很吃力，然后就想着通过一些博客来先入门，结果第一步就踩到坑了。")]),t._v(" "),a("p",[t._v("就是文章的时效性，加上很多转载文")]),t._v(" "),a("p",[t._v("当feign开启熔断器时，博客上统一都是"),a("code",[t._v("feign.hystix.enabled=true")]),t._v("，结果开启后并没有用")]),t._v(" "),a("p",[t._v("查了才知道Spring Cloud2020后feign的jar中移除了hystix，需要额外引入，且开启配置也有变化")]),t._v(" "),a("h2",{attrs:{id:"二、eureka"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、eureka"}},[t._v("#")]),t._v(" 二、eureka")]),t._v(" "),a("p",[t._v("eureka是一个注册中心，基于心跳机制动态维护一个可用服务列表，比如一个查询服务有哪些实例可用他的ip、端口是多少")]),t._v(" "),a("p",[t._v("eureka分为server和client，server就是记录注册信息的地方，而client就是注册者")]),t._v(" "),a("h3",{attrs:{id:"_2-1-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-server"}},[t._v("#")]),t._v(" 2.1 server")]),t._v(" "),a("p",[t._v("server使用起来很简单，只需要导入一个jar包：")]),t._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-netflix-eureka-server"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("然后在Application.Java中添加注解"),a("code",[t._v("@EnableEurekaServer")])]),t._v(" "),a("h3",{attrs:{id:"_2-2-client"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-client"}},[t._v("#")]),t._v(" 2.2 client")]),t._v(" "),a("p",[t._v("client同样简单，也只需要一个jar包")]),t._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n       "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-netflix-eureka-client"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependencies")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br")])]),a("p",[t._v("在client中随便写一个简单接口用作模拟服务提供者，在云服务器和本地分别启动一个实例来模拟集群，再去eureka控制台查看：")]),t._v(" "),a("p",[a("img",{attrs:{src:s(324),alt:"eureka-client"}})]),t._v(" "),a("p",[t._v("可以看到服务已经注册到了eureka中，且有启动的两个实例")]),t._v(" "),a("h3",{attrs:{id:"_2-3-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-配置"}},[t._v("#")]),t._v(" 2.3 配置")]),t._v(" "),a("p",[t._v("eureka使用的重点在配置文件上，Spring Cloud Eureka为分布式系统外部化配置提供了服务器端和客户端的支持，它包括Eureka Server和Eureka Client两部分，因此Spring Cloud Eureka 配置项比较多。")]),t._v(" "),a("p",[t._v("通过application.yml配置，分为四大部分配置，但通常很多配置使用默认配置即可：")]),t._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("instance")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dashboard")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br")])]),a("p",[t._v("具体可以参考："),a("a",{attrs:{href:"https://blog.csdn.net/songjianlong/article/details/131315595",target:"_blank",rel:"noopener noreferrer"}},[t._v("Eureka配置文件详解-CSDN博客"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"三、ribbon"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、ribbon"}},[t._v("#")]),t._v(" 三、ribbon")]),t._v(" "),a("p",[t._v("ribbon用作负载均衡，比如某个服务有3个实例，那么通过负载均衡可以将请求通过一定的策略分布到3个实例上。")]),t._v(" "),a("p",[t._v("负载均衡分为服务端和客户端：")]),t._v(" "),a("Mermaid",{attrs:{id:"mermaid_64a56fb0",graph:t.$dataBlock.mermaid_64a56fb0}}),a("Mermaid",{attrs:{id:"mermaid_64a56fae",graph:t.$dataBlock.mermaid_64a56fae}}),a("p",[t._v("其中ribbon就是客户端负载均衡，即由调用方处理负载均衡(和nginx的区别："),a("a",{attrs:{href:"https://www.jianshu.com/p/49b3a22dbec9",target:"_blank",rel:"noopener noreferrer"}},[t._v("Ribbon与Nginx的区别 - 简书 (jianshu.com)"),a("OutboundLink")],1),t._v(")")]),t._v(" "),a("p",[t._v("优点是快速上手、成本较小，且相比于服务端统一的负载均衡也更灵活")]),t._v(" "),a("p",[t._v("缺点也很明显业务和负载这些运维属性都在程序中，不容易管理")]),t._v(" "),a("h3",{attrs:{id:"_3-1-使用ribbon"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-使用ribbon"}},[t._v("#")]),t._v(" 3.1 使用ribbon")]),t._v(" "),a("p",[t._v("eureka-client包中已经包含了ribbon，因此如果使用了eureka就无需再导入jar包")]),t._v(" "),a("p",[t._v("这里使用"),a("code",[t._v("RestTemplate")]),t._v("来发起请求，只需要使用"),a("code",[t._v("@LoadBalanced")]),t._v("注解即可开启负载均衡")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Configuration")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestConfig")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@LoadBalanced")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("restTemplate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RestTemplate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("h3",{attrs:{id:"_3-2-负载策略和配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-负载策略和配置"}},[t._v("#")]),t._v(" 3.2 负载策略和配置")]),t._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("springcloud-nacos-provider")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nacos中的服务id")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ribbon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NFLoadBalancerRuleClassName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" com.netflix.loadbalancer.RoundRobinRule "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#设置负载均衡")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("table",[a("thead",[a("tr",[a("th",[t._v("策略")]),t._v(" "),a("th",[t._v("说明")]),t._v(" "),a("th",[t._v("配置")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("轮询策略")]),t._v(" "),a("td",[t._v("按照一定的顺序依次调用服务实例，如实例1、2、3")]),t._v(" "),a("td",[a("code",[t._v("com.netflix.loadbalancer.RoundRobinRule")])])]),t._v(" "),a("tr",[a("td",[t._v("权重策略")]),t._v(" "),a("td",[t._v("根据每个服务提供者的响应时间分配一个权重，响应时间越长，权重越小，被选中的可能性也就越低")]),t._v(" "),a("td",[a("code",[t._v("com.netflix.loadbalancer.WeightedResponseTimeRule")])])]),t._v(" "),a("tr",[a("td",[t._v("随机策略")]),t._v(" "),a("td",[t._v("从服务提供者的列表中随机选择一个服务实例")]),t._v(" "),a("td",[a("code",[t._v("com.netflix.loadbalancer.RandomRule")])])]),t._v(" "),a("tr",[a("td",[t._v("最小连接数策略")]),t._v(" "),a("td",[t._v("选取连接数最小的⼀个服务实例。如果有相同的最小连接数，那么会调用轮询策略进行选取")]),t._v(" "),a("td",[a("code",[t._v("com.netflix.loadbalancer.BestAvailableRule")])])]),t._v(" "),a("tr",[a("td",[t._v("重试策略")]),t._v(" "),a("td",[t._v("按照轮询策略来获取服务，如果获取的服务实例为 null 或已经失效，则在指定的时间之内不断地进行重试来获取服务，如果超过指定时间依然没获取到服务实例则返回 null")]),t._v(" "),a("td",[a("code",[t._v("com.netflix.loadbalancer.RetryRule")])])]),t._v(" "),a("tr",[a("td",[t._v("可用性敏感策略")]),t._v(" "),a("td",[t._v("先过滤掉非健康的服务实例，然后再选择连接数较小的服务实例")]),t._v(" "),a("td",[a("code",[t._v("com.netflix.loadbalancer.AvailabilityFilteringRule")])])]),t._v(" "),a("tr",[a("td",[t._v("区域敏感策略")]),t._v(" "),a("td",[t._v("根据服务所在区域(zone)的性能和服务的可用性来选择服务实例，在没有区域的环境下，该策略和轮询策略类似")]),t._v(" "),a("td",[a("code",[t._v("com.netflix.loadbalancer.ZoneAvoidanceRule")])])])])]),t._v(" "),a("p",[t._v("其中重试策略需要额外配置超时时间：")]),t._v(" "),a("div",{staticClass:"language-yml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ribbon")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ConnectTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求连接的超时时间")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ReadTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求处理的超时时间")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("h2",{attrs:{id:"四、feign"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#四、feign"}},[t._v("#")]),t._v(" 四、feign")]),t._v(" "),a("p",[t._v("Feign是Netflix开发的声明式、模板化的HTTP客户端，其灵感来自Retrofit、JAXRS-2.0以及WebSocket。Feign可帮助我们更加快捷、优雅地调用HTTP API")]),t._v(" "),a("p",[t._v("相比之前使用的restTemplate，其host、uri、param都是分开的，因此可读性更佳、也更容易维护")]),t._v(" "),a("h3",{attrs:{id:"_4-1-使用feign"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-使用feign"}},[t._v("#")]),t._v(" 4.1 使用feign")]),t._v(" "),a("p",[t._v("首先需要引入jar包")]),t._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.springframework.cloud"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("spring-cloud-starter-openfeign"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("然后编写一个feignclient接口")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 此处name就是eureka中的服务名，也就相当于是ip：port")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@FeignClient")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user-provider"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("interface")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("RecordFeignClient")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 此处是指服务方的uri，方法入参就是http请求的参数")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/record/{rid}"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Record")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRecord")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PathVariable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"rid"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("String")]),t._v(" rid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("p",[t._v("然后将controller中的restTemplate替换成定义的feignClient，最后还需要在启动类中加上"),a("code",[t._v("@EnableFeignClients")]),t._v("注解")]),t._v(" "),a("p",[t._v("启动程序验证，调用正常，还集成了ribbon负载均衡")]),t._v(" "),a("h3",{attrs:{id:"_4-2-配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-配置"}},[t._v("#")]),t._v(" 4.2 配置")]),t._v(" "),a("p",[t._v("feign的配置和其他配置类似，有Java Bean和yml配置文件两种形式。因为只是了解一下，并不是要使用feign，就不过多去看配置了")]),t._v(" "),a("p",[t._v("具体可以看："),a("a",{attrs:{href:"https://blog.csdn.net/qi341500/article/details/129300783",target:"_blank",rel:"noopener noreferrer"}},[t._v("SpringCloud：Feign的使用及配置_feignclient配置_Poetry-Distance的博客-CSDN博客"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"五、hystrix"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#五、hystrix"}},[t._v("#")]),t._v(" 五、Hystrix")]),t._v(" "),a("p",[t._v("Hystrix是一个实现了超时机制和断路器模式的工具类库，用于隔离访问远程系统、服务或者第三方库，防止级联失败，从而提升系统的可用性与容错性")]),t._v(" "),a("p",[t._v("也就是针对服务调用的一个断路器，当依赖服务出现问题时，切断链路减少本服务受到的影响。可以结合feign使用，也可以单独使用")]),t._v(" "),a("p",[t._v("结合feign使用或者单独使用都很简单，具体使用可以参考："),a("a",{attrs:{href:"https://blog.csdn.net/qq_44112474/article/details/109094254",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hystrix入门实战(完整版)_hystrix教程-CSDN博客"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("注意新版本和文中有些出入")]),t._v(" "),a("h2",{attrs:{id:"六、zuul"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#六、zuul"}},[t._v("#")]),t._v(" 六、Zuul")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://blog.csdn.net/qq_44112474/article/details/109094775",target:"_blank",rel:"noopener noreferrer"}},[t._v("Zuul入门实战(完整版)-CSDN博客"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"七、感受"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#七、感受"}},[t._v("#")]),t._v(" 七、感受")]),t._v(" "),a("p",[t._v("Spring Cloud Netflix算是一套比较完整的微服务框架，搭建也很快、成本很低，适合小型企业快速启动")]),t._v(" "),a("p",[t._v("至于性能上，没有能够验证的环境与流量，无法验证他和其他框架的差别，但至少使用上来说还算便捷")])],1)}),[],!1,null,null,null);"function"==typeof e&&e(r);a.default=r.exports}}]);