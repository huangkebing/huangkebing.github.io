<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Cloud尝试 | program-inn</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/images/system/favicon.ico">
    <meta name="description" content="记录，成为更好的自己">
    
    <link rel="preload" href="/assets/css/0.styles.3ab2c0ae.css" as="style"><link rel="preload" href="/assets/js/app.0abfb3be.js" as="script"><link rel="preload" href="/assets/js/2.1e07934a.js" as="script"><link rel="preload" href="/assets/js/1.da9eaebd.js" as="script"><link rel="preload" href="/assets/js/34.43cf8b4b.js" as="script"><link rel="prefetch" href="/assets/js/10.47fced37.js"><link rel="prefetch" href="/assets/js/11.2e7c3c32.js"><link rel="prefetch" href="/assets/js/12.26d92d40.js"><link rel="prefetch" href="/assets/js/13.076abc15.js"><link rel="prefetch" href="/assets/js/14.0ff4122c.js"><link rel="prefetch" href="/assets/js/15.75947085.js"><link rel="prefetch" href="/assets/js/16.2b0b7021.js"><link rel="prefetch" href="/assets/js/17.1d2b4c57.js"><link rel="prefetch" href="/assets/js/18.ee195d82.js"><link rel="prefetch" href="/assets/js/19.5e3a6459.js"><link rel="prefetch" href="/assets/js/20.65309519.js"><link rel="prefetch" href="/assets/js/21.66493763.js"><link rel="prefetch" href="/assets/js/22.1f06f050.js"><link rel="prefetch" href="/assets/js/23.c2b54cbc.js"><link rel="prefetch" href="/assets/js/24.576f28fb.js"><link rel="prefetch" href="/assets/js/25.a838e234.js"><link rel="prefetch" href="/assets/js/26.fd1c592f.js"><link rel="prefetch" href="/assets/js/27.2c462c43.js"><link rel="prefetch" href="/assets/js/28.6474a7d1.js"><link rel="prefetch" href="/assets/js/29.ceed2757.js"><link rel="prefetch" href="/assets/js/3.a2d53dd8.js"><link rel="prefetch" href="/assets/js/30.a5a6e34a.js"><link rel="prefetch" href="/assets/js/31.c53ae09d.js"><link rel="prefetch" href="/assets/js/32.d8a0af99.js"><link rel="prefetch" href="/assets/js/33.a28765ad.js"><link rel="prefetch" href="/assets/js/35.24758f53.js"><link rel="prefetch" href="/assets/js/36.0f2bcfe7.js"><link rel="prefetch" href="/assets/js/37.06964653.js"><link rel="prefetch" href="/assets/js/38.458fa725.js"><link rel="prefetch" href="/assets/js/39.0c45f2e8.js"><link rel="prefetch" href="/assets/js/4.77cca8ed.js"><link rel="prefetch" href="/assets/js/40.e39031c0.js"><link rel="prefetch" href="/assets/js/41.a604420d.js"><link rel="prefetch" href="/assets/js/42.cc1e66e9.js"><link rel="prefetch" href="/assets/js/43.83395527.js"><link rel="prefetch" href="/assets/js/44.18f1f668.js"><link rel="prefetch" href="/assets/js/45.257316f0.js"><link rel="prefetch" href="/assets/js/46.2ec91976.js"><link rel="prefetch" href="/assets/js/47.1c955418.js"><link rel="prefetch" href="/assets/js/48.7fcc070f.js"><link rel="prefetch" href="/assets/js/49.bc456003.js"><link rel="prefetch" href="/assets/js/5.e9bab77b.js"><link rel="prefetch" href="/assets/js/50.0e2cf3ed.js"><link rel="prefetch" href="/assets/js/51.6756eca0.js"><link rel="prefetch" href="/assets/js/52.30bee95e.js"><link rel="prefetch" href="/assets/js/53.c8cbaa07.js"><link rel="prefetch" href="/assets/js/54.6629e11c.js"><link rel="prefetch" href="/assets/js/55.6dbae9d4.js"><link rel="prefetch" href="/assets/js/56.34395b76.js"><link rel="prefetch" href="/assets/js/57.aac9df56.js"><link rel="prefetch" href="/assets/js/58.5a74b93e.js"><link rel="prefetch" href="/assets/js/6.98eac0a6.js"><link rel="prefetch" href="/assets/js/7.9b1c9615.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.89026c5a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3ab2c0ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">program-inn</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/md/guide/2024-01-01-1-guide.html" class="nav-link">
  导读
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/spring-cloud/.html" class="nav-link">
  容器
</a></li><li class="dropdown-item"><!----> <a href="/md/java/thread/2023-12-28-1-并发的基本概念.html" class="nav-link">
  并发
</a></li><li class="dropdown-item"><!----> <a href="/md/java/jvm/2023-05-26-1-走近Java.html" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><span class="title">Spring</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring" class="mobile-dropdown-title"><span class="title">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/spring-framework/2023-11-14-1-前言&amp;环境构建.html" class="nav-link">
  spring framework
</a></li><li class="dropdown-item"><!----> <a href="/md/spring/spring-framework-code/BeanDefinition/2023-11-24-1-BeanDefinition概述.html" class="nav-link">
  spring framework源码
</a></li><li class="dropdown-item"><!----> <a href="/md/spring/spring-cloud/2023-08-18-1-SpringCloud尝试.html" class="nav-link">
  Spring Cloud
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/algorithm/offer/2023-05-10-1-剑指offer.html" class="nav-link">
  剑指offer系列
</a></li><li class="dropdown-item"><!----> <a href="/md/algorithm/offer2/2023-08-02-1-剑指offer2.html" class="nav-link">
  剑指offerⅡ系列
</a></li><li class="dropdown-item"><!----> <a href="/md/algorithm/point/2023-06-13-1-排序专项.html" class="nav-link">
  专项系列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础巩固" class="dropdown-title"><span class="title">基础巩固</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础巩固" class="mobile-dropdown-title"><span class="title">基础巩固</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/spring-cloud/.html" class="nav-link">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><a href="/md/utils/2023-01-01-1-blogs.html" class="nav-link">
  工具杂记
</a></div><div class="nav-item"><a href="https://github.com/huangkebing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/md/guide/2024-01-01-1-guide.html" class="nav-link">
  导读
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/spring-cloud/.html" class="nav-link">
  容器
</a></li><li class="dropdown-item"><!----> <a href="/md/java/thread/2023-12-28-1-并发的基本概念.html" class="nav-link">
  并发
</a></li><li class="dropdown-item"><!----> <a href="/md/java/jvm/2023-05-26-1-走近Java.html" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><span class="title">Spring</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring" class="mobile-dropdown-title"><span class="title">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/spring-framework/2023-11-14-1-前言&amp;环境构建.html" class="nav-link">
  spring framework
</a></li><li class="dropdown-item"><!----> <a href="/md/spring/spring-framework-code/BeanDefinition/2023-11-24-1-BeanDefinition概述.html" class="nav-link">
  spring framework源码
</a></li><li class="dropdown-item"><!----> <a href="/md/spring/spring-cloud/2023-08-18-1-SpringCloud尝试.html" class="nav-link">
  Spring Cloud
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/algorithm/offer/2023-05-10-1-剑指offer.html" class="nav-link">
  剑指offer系列
</a></li><li class="dropdown-item"><!----> <a href="/md/algorithm/offer2/2023-08-02-1-剑指offer2.html" class="nav-link">
  剑指offerⅡ系列
</a></li><li class="dropdown-item"><!----> <a href="/md/algorithm/point/2023-06-13-1-排序专项.html" class="nav-link">
  专项系列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础巩固" class="dropdown-title"><span class="title">基础巩固</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础巩固" class="mobile-dropdown-title"><span class="title">基础巩固</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/spring-cloud/.html" class="nav-link">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><a href="/md/utils/2023-01-01-1-blogs.html" class="nav-link">
  工具杂记
</a></div><div class="nav-item"><a href="https://github.com/huangkebing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Spring Cloud系列</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/spring/spring-cloud/2023-08-18-1-SpringCloud尝试.html" class="active sidebar-link">Spring Cloud尝试</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="spring-cloud尝试"><a href="#spring-cloud尝试" class="header-anchor">#</a> Spring Cloud尝试</h1> <p>因为Spring Cloud <code>2022.0.4</code>版本需要依赖Spring Boot<code>3.0.9</code>，而目前更多使用的是Spring Boot 2.x版本</p> <p>所以这里Spring Cloud版本选用<code>2021.0.8</code>，相对应的跟据官方文档，Spring Boot版本选用<code>2.6.15</code>，</p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>这里Spring Cloud版本号有个命名变更，之前是使用A-Z的伦敦地铁站命名如：<code>Hoxton.SR1</code>，而从2020年开始命名改为日期格式如：<code>2020.0.0-M1</code></p></div> <h2 id="一、概念理解"><a href="#一、概念理解" class="header-anchor">#</a> 一、概念理解</h2> <p>接触一个新东西就得先理解他的相关概念，然后才能找到门道</p> <h3 id="_1-1-什么是spring-cloud"><a href="#_1-1-什么是spring-cloud" class="header-anchor">#</a> 1.1 什么是Spring Cloud</h3> <p>首先通过Spring文档，可以看到Spring Cloud有很多子模块。如：Spring Cloud Alibaba、Spring Cloud Config、Spring Cloud Netflix等等。这些到底是什么？和Spring Cloud又有什么关系？</p> <p>通过百度百科了解到：</p> <p>Spring Cloud是一系列框架的有序集合。它利用Spring Boot的开发便利性巧妙地简化了分布式系统基础设施的开发，如服务发现注册、配置中心、消息总线、负载均衡、断路器、数据监控等，都可以用Spring Boot的开发风格做到一键启动和部署。Spring Cloud并没有重复制造轮子，它只是将各家公司开发的比较成熟、经得起实际考验的服务框架组合起来，通过Spring Boot风格进行再封装屏蔽掉了复杂的配置和实现原理，最终给开发者留出了一套简单易懂、易部署和易维护的分布式系统开发工具包。</p> <p>也就是说，这些子模块其实就是将优秀的开源框架结构Spring Boot形成的，这些子模块功能各异，并不是说要全部都用上</p> <p>了解到这么多模块中Spring Cloud Netflix是最常见的一套，因此先从这个模块入手</p> <h3 id="_1-2-什么是spring-cloud-netflix"><a href="#_1-2-什么是spring-cloud-netflix" class="header-anchor">#</a> 1.2 什么是Spring Cloud Netflix</h3> <p>官方文档中描述到：</p> <p>该项目通过自动配置和绑定到Spring环境和其他Spring编程模型习惯用法，为Spring Boot应用程序提供Netflix的OSS集成。通过一些简单的注释，您可以快速启用和配置应用程序中的常见模式，并使用久经考验的Netflix组件构建大型分布式系统。</p> <p>在博客<a href="https://blog.csdn.net/qq_44112474/article/details/109050543" target="_blank" rel="noopener noreferrer">5.Spring Cloud快速入门-CSDN博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中了解到：</p> <p>Netflix：微服务大规模的应用，在技术上毫无保留的把一整套微服务架构核心技术栈开源了出来，叫做Netflix OSS</p> <ul><li>Eureka：注册中心</li> <li>Zuul：服务网关</li> <li>Ribbon：负载均衡</li> <li>Feign：服务调用</li> <li>Hystix：熔断</li></ul> <h3 id="_1-3-踩坑了"><a href="#_1-3-踩坑了" class="header-anchor">#</a> 1.3 踩坑了</h3> <p>最初的想法是通过官方文档来学习，但因为不了解cloud的结构和设计，看起来觉得很乱很吃力，然后就想着通过一些博客来先入门，结果第一步就踩到坑了。</p> <p>就是文章的时效性，加上很多转载文</p> <p>当feign开启熔断器时，博客上统一都是<code>feign.hystix.enabled=true</code>，结果开启后并没有用</p> <p>查了才知道Spring Cloud2020后feign的jar中移除了hystix，需要额外引入，且开启配置也有变化</p> <h2 id="二、eureka"><a href="#二、eureka" class="header-anchor">#</a> 二、eureka</h2> <p>eureka是一个注册中心，基于心跳机制动态维护一个可用服务列表，比如一个查询服务有哪些实例可用他的ip、端口是多少</p> <p>eureka分为server和client，server就是记录注册信息的地方，而client就是注册者</p> <h3 id="_2-1-server"><a href="#_2-1-server" class="header-anchor">#</a> 2.1 server</h3> <p>server使用起来很简单，只需要导入一个jar包：</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-server<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>然后在Application.Java中添加注解<code>@EnableEurekaServer</code></p> <h3 id="_2-2-client"><a href="#_2-2-client" class="header-anchor">#</a> 2.2 client</h3> <p>client同样简单，也只需要一个jar包</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
       <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-netflix-eureka-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在client中随便写一个简单接口用作模拟服务提供者，在云服务器和本地分别启动一个实例来模拟集群，再去eureka控制台查看：</p> <p><img src="/assets/img/eureka-client.3e26dc9a.jpg" alt="eureka-client"></p> <p>可以看到服务已经注册到了eureka中，且有启动的两个实例</p> <h3 id="_2-3-配置"><a href="#_2-3-配置" class="header-anchor">#</a> 2.3 配置</h3> <p>eureka使用的重点在配置文件上，Spring Cloud Eureka为分布式系统外部化配置提供了服务器端和客户端的支持，它包括Eureka Server和Eureka Client两部分，因此Spring Cloud Eureka 配置项比较多。</p> <p>通过application.yml配置，分为四大部分配置，但通常很多配置使用默认配置即可：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">eureka</span><span class="token punctuation">:</span>
	<span class="token key atrule">instance</span><span class="token punctuation">:</span>
	<span class="token key atrule">client</span><span class="token punctuation">:</span>
	<span class="token key atrule">server</span><span class="token punctuation">:</span>
	<span class="token key atrule">dashboard</span><span class="token punctuation">:</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>具体可以参考：<a href="https://blog.csdn.net/songjianlong/article/details/131315595" target="_blank" rel="noopener noreferrer">Eureka配置文件详解-CSDN博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="三、ribbon"><a href="#三、ribbon" class="header-anchor">#</a> 三、ribbon</h2> <p>ribbon用作负载均衡，比如某个服务有3个实例，那么通过负载均衡可以将请求通过一定的策略分布到3个实例上。</p> <p>负载均衡分为服务端和客户端：</p> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>其中ribbon就是客户端负载均衡，即由调用方处理负载均衡(和nginx的区别：<a href="https://www.jianshu.com/p/49b3a22dbec9" target="_blank" rel="noopener noreferrer">Ribbon与Nginx的区别 - 简书 (jianshu.com)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>)</p> <p>优点是快速上手、成本较小，且相比于服务端统一的负载均衡也更灵活</p> <p>缺点也很明显业务和负载这些运维属性都在程序中，不容易管理</p> <h3 id="_3-1-使用ribbon"><a href="#_3-1-使用ribbon" class="header-anchor">#</a> 3.1 使用ribbon</h3> <p>eureka-client包中已经包含了ribbon，因此如果使用了eureka就无需再导入jar包</p> <p>这里使用<code>RestTemplate</code>来发起请求，只需要使用<code>@LoadBalanced</code>注解即可开启负载均衡</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_3-2-负载策略和配置"><a href="#_3-2-负载策略和配置" class="header-anchor">#</a> 3.2 负载策略和配置</h3> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">springcloud-nacos-provider</span><span class="token punctuation">:</span> <span class="token comment"># nacos中的服务id</span>
  <span class="token key atrule">ribbon</span><span class="token punctuation">:</span>
    <span class="token key atrule">NFLoadBalancerRuleClassName</span><span class="token punctuation">:</span> com.netflix.loadbalancer.RoundRobinRule <span class="token comment">#设置负载均衡</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><table><thead><tr><th>策略</th> <th>说明</th> <th>配置</th></tr></thead> <tbody><tr><td>轮询策略</td> <td>按照一定的顺序依次调用服务实例，如实例1、2、3</td> <td><code>com.netflix.loadbalancer.RoundRobinRule</code></td></tr> <tr><td>权重策略</td> <td>根据每个服务提供者的响应时间分配一个权重，响应时间越长，权重越小，被选中的可能性也就越低</td> <td><code>com.netflix.loadbalancer.WeightedResponseTimeRule</code></td></tr> <tr><td>随机策略</td> <td>从服务提供者的列表中随机选择一个服务实例</td> <td><code>com.netflix.loadbalancer.RandomRule</code></td></tr> <tr><td>最小连接数策略</td> <td>选取连接数最小的⼀个服务实例。如果有相同的最小连接数，那么会调用轮询策略进行选取</td> <td><code>com.netflix.loadbalancer.BestAvailableRule</code></td></tr> <tr><td>重试策略</td> <td>按照轮询策略来获取服务，如果获取的服务实例为 null 或已经失效，则在指定的时间之内不断地进行重试来获取服务，如果超过指定时间依然没获取到服务实例则返回 null</td> <td><code>com.netflix.loadbalancer.RetryRule</code></td></tr> <tr><td>可用性敏感策略</td> <td>先过滤掉非健康的服务实例，然后再选择连接数较小的服务实例</td> <td><code>com.netflix.loadbalancer.AvailabilityFilteringRule</code></td></tr> <tr><td>区域敏感策略</td> <td>根据服务所在区域(zone)的性能和服务的可用性来选择服务实例，在没有区域的环境下，该策略和轮询策略类似</td> <td><code>com.netflix.loadbalancer.ZoneAvoidanceRule</code></td></tr></tbody></table> <p>其中重试策略需要额外配置超时时间：</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">ribbon</span><span class="token punctuation">:</span>
  <span class="token key atrule">ConnectTimeout</span><span class="token punctuation">:</span> <span class="token number">2000</span> <span class="token comment"># 请求连接的超时时间</span>
  <span class="token key atrule">ReadTimeout</span><span class="token punctuation">:</span> <span class="token number">5000</span> <span class="token comment"># 请求处理的超时时间</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="四、feign"><a href="#四、feign" class="header-anchor">#</a> 四、feign</h2> <p>Feign是Netflix开发的声明式、模板化的HTTP客户端，其灵感来自Retrofit、JAXRS-2.0以及WebSocket。Feign可帮助我们更加快捷、优雅地调用HTTP API</p> <p>相比之前使用的restTemplate，其host、uri、param都是分开的，因此可读性更佳、也更容易维护</p> <h3 id="_4-1-使用feign"><a href="#_4-1-使用feign" class="header-anchor">#</a> 4.1 使用feign</h3> <p>首先需要引入jar包</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-openfeign<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>然后编写一个feignclient接口</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 此处name就是eureka中的服务名，也就相当于是ip：port</span>
<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;user-provider&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">RecordFeignClient</span> <span class="token punctuation">{</span>
    <span class="token comment">// 此处是指服务方的uri，方法入参就是http请求的参数</span>
    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/record/{rid}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">Record</span> <span class="token function">getRecord</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;rid&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> rid<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>然后将controller中的restTemplate替换成定义的feignClient，最后还需要在启动类中加上<code>@EnableFeignClients</code>注解</p> <p>启动程序验证，调用正常，还集成了ribbon负载均衡</p> <h3 id="_4-2-配置"><a href="#_4-2-配置" class="header-anchor">#</a> 4.2 配置</h3> <p>feign的配置和其他配置类似，有Java Bean和yml配置文件两种形式。因为只是了解一下，并不是要使用feign，就不过多去看配置了</p> <p>具体可以看：<a href="https://blog.csdn.net/qi341500/article/details/129300783" target="_blank" rel="noopener noreferrer">SpringCloud：Feign的使用及配置_feignclient配置_Poetry-Distance的博客-CSDN博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="五、hystrix"><a href="#五、hystrix" class="header-anchor">#</a> 五、Hystrix</h2> <p>Hystrix是一个实现了超时机制和断路器模式的工具类库，用于隔离访问远程系统、服务或者第三方库，防止级联失败，从而提升系统的可用性与容错性</p> <p>也就是针对服务调用的一个断路器，当依赖服务出现问题时，切断链路减少本服务受到的影响。可以结合feign使用，也可以单独使用</p> <p>结合feign使用或者单独使用都很简单，具体使用可以参考：<a href="https://blog.csdn.net/qq_44112474/article/details/109094254" target="_blank" rel="noopener noreferrer">Hystrix入门实战(完整版)_hystrix教程-CSDN博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>注意新版本和文中有些出入</p> <h2 id="六、zuul"><a href="#六、zuul" class="header-anchor">#</a> 六、Zuul</h2> <p><a href="https://blog.csdn.net/qq_44112474/article/details/109094775" target="_blank" rel="noopener noreferrer">Zuul入门实战(完整版)-CSDN博客<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="七、感受"><a href="#七、感受" class="header-anchor">#</a> 七、感受</h2> <p>Spring Cloud Netflix算是一套比较完整的微服务框架，搭建也很快、成本很低，适合小型企业快速启动</p> <p>至于性能上，没有能够验证的环境与流量，无法验证他和其他框架的差别，但至少使用上来说还算便捷</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2023/12/28 16:55:12</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.0abfb3be.js" defer></script><script src="/assets/js/2.1e07934a.js" defer></script><script src="/assets/js/1.da9eaebd.js" defer></script><script src="/assets/js/34.43cf8b4b.js" defer></script>
  </body>
</html>
