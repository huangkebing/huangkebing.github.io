<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第二章、IoC概念、容器和bean定义 | program-inn</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/images/system/favicon.ico">
    <meta name="description" content="记录，成为更好的自己">
    
    <link rel="preload" href="/assets/css/0.styles.3ab2c0ae.css" as="style"><link rel="preload" href="/assets/js/app.85ba2fc4.js" as="script"><link rel="preload" href="/assets/js/2.a518c566.js" as="script"><link rel="preload" href="/assets/js/1.b931f3c5.js" as="script"><link rel="preload" href="/assets/js/40.1d2b5a3c.js" as="script"><link rel="prefetch" href="/assets/js/10.47fced37.js"><link rel="prefetch" href="/assets/js/11.2e7c3c32.js"><link rel="prefetch" href="/assets/js/12.26d92d40.js"><link rel="prefetch" href="/assets/js/13.3320378d.js"><link rel="prefetch" href="/assets/js/14.0ff4122c.js"><link rel="prefetch" href="/assets/js/15.75947085.js"><link rel="prefetch" href="/assets/js/16.bdff9f1f.js"><link rel="prefetch" href="/assets/js/17.1d2b4c57.js"><link rel="prefetch" href="/assets/js/18.ee195d82.js"><link rel="prefetch" href="/assets/js/19.5e3a6459.js"><link rel="prefetch" href="/assets/js/20.da39d085.js"><link rel="prefetch" href="/assets/js/21.dcc3a646.js"><link rel="prefetch" href="/assets/js/22.1f06f050.js"><link rel="prefetch" href="/assets/js/23.c2b54cbc.js"><link rel="prefetch" href="/assets/js/24.722cdae3.js"><link rel="prefetch" href="/assets/js/25.00b10f35.js"><link rel="prefetch" href="/assets/js/26.fd1c592f.js"><link rel="prefetch" href="/assets/js/27.b7bc8e33.js"><link rel="prefetch" href="/assets/js/28.f1547a7c.js"><link rel="prefetch" href="/assets/js/29.30ac9788.js"><link rel="prefetch" href="/assets/js/3.a2d53dd8.js"><link rel="prefetch" href="/assets/js/30.2fb65ac2.js"><link rel="prefetch" href="/assets/js/31.0c81b50c.js"><link rel="prefetch" href="/assets/js/32.eef42f26.js"><link rel="prefetch" href="/assets/js/33.b341156f.js"><link rel="prefetch" href="/assets/js/34.ed35b4a9.js"><link rel="prefetch" href="/assets/js/35.8f56b49a.js"><link rel="prefetch" href="/assets/js/36.12361114.js"><link rel="prefetch" href="/assets/js/37.45d52714.js"><link rel="prefetch" href="/assets/js/38.45a51034.js"><link rel="prefetch" href="/assets/js/39.c11cc4d4.js"><link rel="prefetch" href="/assets/js/4.8df98e1b.js"><link rel="prefetch" href="/assets/js/41.61dae5a0.js"><link rel="prefetch" href="/assets/js/42.7bff21a2.js"><link rel="prefetch" href="/assets/js/43.235c30c3.js"><link rel="prefetch" href="/assets/js/44.af7ce221.js"><link rel="prefetch" href="/assets/js/45.b3c27af5.js"><link rel="prefetch" href="/assets/js/46.52b58dee.js"><link rel="prefetch" href="/assets/js/47.02c24827.js"><link rel="prefetch" href="/assets/js/48.8446b0b9.js"><link rel="prefetch" href="/assets/js/49.208f32d5.js"><link rel="prefetch" href="/assets/js/5.a0893d1a.js"><link rel="prefetch" href="/assets/js/50.6d78d8aa.js"><link rel="prefetch" href="/assets/js/51.9753a583.js"><link rel="prefetch" href="/assets/js/52.874be367.js"><link rel="prefetch" href="/assets/js/53.09b81b7b.js"><link rel="prefetch" href="/assets/js/54.562e13b1.js"><link rel="prefetch" href="/assets/js/55.f9183971.js"><link rel="prefetch" href="/assets/js/56.cafce76b.js"><link rel="prefetch" href="/assets/js/57.440ff033.js"><link rel="prefetch" href="/assets/js/58.31b2dd66.js"><link rel="prefetch" href="/assets/js/59.d49b7b26.js"><link rel="prefetch" href="/assets/js/6.2964e58c.js"><link rel="prefetch" href="/assets/js/60.5de5aeab.js"><link rel="prefetch" href="/assets/js/61.43429813.js"><link rel="prefetch" href="/assets/js/62.ffb8bf11.js"><link rel="prefetch" href="/assets/js/63.87660ea9.js"><link rel="prefetch" href="/assets/js/64.d5e60d77.js"><link rel="prefetch" href="/assets/js/65.085871b8.js"><link rel="prefetch" href="/assets/js/66.84234e92.js"><link rel="prefetch" href="/assets/js/67.850099e3.js"><link rel="prefetch" href="/assets/js/68.03d944a5.js"><link rel="prefetch" href="/assets/js/69.b7980cef.js"><link rel="prefetch" href="/assets/js/7.76207249.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.d9dffa33.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3ab2c0ae.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">program-inn</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/md/guide/2024-01-01-1-guide.html" class="nav-link">
  导读
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/spring-framework/.html" class="nav-link">
  容器
</a></li><li class="dropdown-item"><!----> <a href="/md/java/thread/2023-12-28-1-并发的基本概念.html" class="nav-link">
  并发
</a></li><li class="dropdown-item"><!----> <a href="/md/java/jvm/2023-05-26-1-走近Java.html" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><span class="title">Spring</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring" class="mobile-dropdown-title"><span class="title">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/spring-framework/2023-11-14-1-前言&amp;环境构建.html" class="nav-link">
  spring framework
</a></li><li class="dropdown-item"><!----> <a href="/md/spring/spring-framework-code/BeanDefinition/2023-11-24-1-BeanDefinition概述.html" class="nav-link">
  spring framework源码
</a></li><li class="dropdown-item"><!----> <a href="/md/spring/spring-cloud/2023-08-18-1-SpringCloud尝试.html" class="nav-link">
  Spring Cloud
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/spring-framework/.html" class="nav-link">
  tomcat
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/algorithm/offer/2023-05-10-1-剑指offer.html" class="nav-link">
  剑指offer系列
</a></li><li class="dropdown-item"><!----> <a href="/md/algorithm/offer2/2023-08-02-1-剑指offer2.html" class="nav-link">
  剑指offerⅡ系列
</a></li><li class="dropdown-item"><!----> <a href="/md/algorithm/point/2023-06-13-1-排序专项.html" class="nav-link">
  专项系列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础巩固" class="dropdown-title"><span class="title">基础巩固</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础巩固" class="mobile-dropdown-title"><span class="title">基础巩固</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/spring-framework/.html" class="nav-link">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><a href="/md/utils/2023-01-01-1-blogs.html" class="nav-link">
  工具杂记
</a></div><div class="nav-item"><a href="https://github.com/huangkebing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/md/guide/2024-01-01-1-guide.html" class="nav-link">
  导读
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Java" class="dropdown-title"><span class="title">Java</span> <span class="arrow down"></span></button> <button type="button" aria-label="Java" class="mobile-dropdown-title"><span class="title">Java</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/spring-framework/.html" class="nav-link">
  容器
</a></li><li class="dropdown-item"><!----> <a href="/md/java/thread/2023-12-28-1-并发的基本概念.html" class="nav-link">
  并发
</a></li><li class="dropdown-item"><!----> <a href="/md/java/jvm/2023-05-26-1-走近Java.html" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring" class="dropdown-title"><span class="title">Spring</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring" class="mobile-dropdown-title"><span class="title">Spring</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/spring-framework/2023-11-14-1-前言&amp;环境构建.html" class="nav-link">
  spring framework
</a></li><li class="dropdown-item"><!----> <a href="/md/spring/spring-framework-code/BeanDefinition/2023-11-24-1-BeanDefinition概述.html" class="nav-link">
  spring framework源码
</a></li><li class="dropdown-item"><!----> <a href="/md/spring/spring-cloud/2023-08-18-1-SpringCloud尝试.html" class="nav-link">
  Spring Cloud
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/spring-framework/.html" class="nav-link">
  tomcat
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="算法" class="dropdown-title"><span class="title">算法</span> <span class="arrow down"></span></button> <button type="button" aria-label="算法" class="mobile-dropdown-title"><span class="title">算法</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/algorithm/offer/2023-05-10-1-剑指offer.html" class="nav-link">
  剑指offer系列
</a></li><li class="dropdown-item"><!----> <a href="/md/algorithm/offer2/2023-08-02-1-剑指offer2.html" class="nav-link">
  剑指offerⅡ系列
</a></li><li class="dropdown-item"><!----> <a href="/md/algorithm/point/2023-06-13-1-排序专项.html" class="nav-link">
  专项系列
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础巩固" class="dropdown-title"><span class="title">基础巩固</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础巩固" class="mobile-dropdown-title"><span class="title">基础巩固</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/md/spring/spring-framework/.html" class="nav-link">
  计算机网络
</a></li></ul></div></div><div class="nav-item"><a href="/md/utils/2023-01-01-1-blogs.html" class="nav-link">
  工具杂记
</a></div><div class="nav-item"><a href="https://github.com/huangkebing" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>spring framework</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/md/spring/spring-framework/2023-11-14-1-前言&amp;环境构建.html" class="sidebar-link">第一章、spring framework源码环境</a></li><li><a href="/md/spring/spring-framework/2023-11-15-2-IoC概念容器和bean定义.html" class="active sidebar-link">第二章、IoC概念、容器和bean定义</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="一、什么是ioc"><a href="#一、什么是ioc" class="header-anchor">#</a> 一、什么是IoC</h2> <p>{% notel red 到底是什么是IoC？%}</p> <p>只要提到spring，肯定能听到IoC、AOP这两个词。这里我们先学习IoC，先从了解到底什么是IoC开始</p> <p>{% endnotel %}</p> <p>IoC全称Inversion of Control，意为控制反转</p> <p>{% notel green 官方文档描述 %}</p> <p>IoC也被称为依赖注入（DI）。它是一个过程，对象仅通过构造参数、工厂方法的参数或在对象实例被构造或从工厂方法返回后在其上设置的属性来定义其依赖关系（即它们与之合作的其他对象）。然后容器在创建 bean 时注入这些依赖关系。这个过程从根本上说是Bean本身通过使用直接构建类或诸如服务定位模式的机制来控制其依赖关系的实例化或位置的逆过程（因此被称为控制反转）。</p> <p>{% endnotel %}</p> <p>先看一个示例，比如一个dao层：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> userDaoImpl <span class="token keyword">implements</span> userDao<span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在传统设计中，service依赖了dao，就需要自己new：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> userService<span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserDaoImpl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>而有了IoC之后，结合自动注入：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> userService<span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>可以看到原先需要我们自行new对象来建构调用链路，现在就交给了框架来构建</p> <p>{% notel green 一些理解 %}</p> <p>IoC是一种设计思想，而不是一个具体的技术实现。IoC 的思想就是将原本在程序中手动创建对象的控制权，交由 Spring 框架来管理</p> <ul><li><strong>控制</strong>：指的是对象创建（实例化、管理）的权力</li> <li><strong>反转</strong>：控制权交给外部环境（Spring 框架、IoC 容器）</li></ul> <div class="spinner" style="background:rgb(66, 185, 131);" data-v-1bbcb91a></div><p>有了IoC，我们可以免于系统大部分类的实例化，简化开发(当然排除一些实体类)</p> <p>{% endnotel %}</p> <h2 id="二、容器"><a href="#二、容器" class="header-anchor">#</a> 二、容器</h2> <p>依照官方文档，构成你的应用程序的骨干并由Spring IoC容器管理的对象被称为Bean。Bean是一个由Spring IoC容器实例化、组装和管理的对象。那么这个容器到底是什么？如何实现的呢？</p> <p>简单猜想：我们知道可以通过beanName来获取bean，那就有点类似是k-v键值对，所以可以先推测spring是使用map来存储bean的</p> <p>首先，编写一个简单测试，通过ApplicationContext来获取bean。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Data</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> id<span class="token punctuation">;</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> userName<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserConfig</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Bean</span>
	<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;spring&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>因为这里不是用xml定义bean而是注解，所以需要使用<code>AnnotationConfigApplicationContext</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token class-name">UserConfig</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 此处打断点，进行单步调试</span>
      <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;user&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在注释处打断点，进行单步调试</p> <p>最终在<code>DefaultSingletonBeanRegistry</code>的<code>getSingleton(String, boolean)</code>方法中取到了bean，也见到了bean存放的地方：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/** Cache of singleton objects: bean name to bean instance. */</span>
<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> singletonObjects <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentHashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在知道了bean容器是<code>ConcurrentHashMap</code>之外，还发现不管是类名、方法名还是变量名都有<code>singleton</code>，这很自然可以联想到<code>@Scope</code>作用域注解，可能不同作用域的bean存放在不同的地方，这一点后续再验证</p> <h2 id="三、bean简单了解"><a href="#三、bean简单了解" class="header-anchor">#</a> 三、bean简单了解</h2> <p>官方文档中有这样一张图，从图中我们可以获得的信息：</p> <ul><li>想要创建bean，需要business objects，也就是我们的业务类</li> <li>还需要configuration metadata，也就是配置元数据</li> <li>有以上两者后，spring容器会替我们实例化，让我们可以直接拿来使用</li></ul> <p><img src="data:image/png;base64,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" alt="container-magic"></p> <p>基于xml的配置是spring最初的唯一配置方式，但随着spring的发展，注解配置逐渐兴起。现在更多是使用注解的形式，相比于xml更加方便(尤其是Spring Boot兴起后)。这里我想把各种定义bean的方式都尝试一遍，这样对这一块的认知会比较完整，但先还是跟着官方文档走，用最初的定义方式，后面会涉及。</p> <p>关于spring注解的发展可以看：<a href="https://juejin.cn/post/7277799132110569533" target="_blank" rel="noopener noreferrer">Spring注解编程的发展过程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>关于bean的定义方式：<a href="https://juejin.cn/post/6981815953784995847" target="_blank" rel="noopener noreferrer">面试官：spring中定义bean的方法有哪些? 我一口气说出了12种，把面试官彻底征服了。 - 掘金 (juejin.cn)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h3 id="_3-1-bean的定义和使用"><a href="#_3-1-bean的定义和使用" class="header-anchor">#</a> 3.1 bean的定义和使用</h3> <p>首先，先编写一个初始用例。UserService依赖UserDao实现了一个用户查询逻辑：</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
	<span class="token class-name">User</span> <span class="token function">queryUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserService</span> <span class="token punctuation">{</span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">UserDao</span> userDao<span class="token punctuation">;</span>
	<span class="token comment">// 这里必须提供set方法或者构造器，否则无法注入依赖</span>
	<span class="token keyword">public</span> <span class="token class-name">UserServiceImpl</span><span class="token punctuation">(</span><span class="token class-name">UserDao</span> userDao<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>userDao <span class="token operator">=</span> userDao<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">queryUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> userDao<span class="token punctuation">.</span><span class="token function">queryById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">UserDao</span> <span class="token punctuation">{</span>
	<span class="token class-name">User</span> <span class="token function">queryById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserDaoImpl</span> <span class="token keyword">implements</span> <span class="token class-name">UserDao</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token class-name">User</span> <span class="token function">queryById</span><span class="token punctuation">(</span><span class="token class-name">String</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> <span class="token string">&quot;Spring Framework&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在resources目录下，创建spring.xml，把两面两个类注册为bean</p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
	   <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
	   <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.kebing.dao.impl.UserDaoImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.kebing.service.impl.UserServiceImpl<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--这个和类提供了构造器还是set方法有关，这里是通过构造器注入，使用property实现set方法注入--&gt;</span>
        <span class="token comment">&lt;!--name字段是userService中的成员变量名，ref是另一个bean的id--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userDao<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userDao<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>userDao<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>通过ApplicationContext来获取bean：</p> <p>这里有一个点，正常情况下我们的项目里是不需要自己调ApplicationContext.getBean来获取bean的</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token class-name">ApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;spring.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">UserService</span> userService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">,</span> <span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userService<span class="token punctuation">.</span><span class="token function">queryUser</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>可以看到控制台打印：</p> <div class="language-txt line-numbers-mode"><pre class="language-txt"><code>User{id='3', userName='Spring Framework'}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_3-2-beandefinition"><a href="#_3-2-beandefinition" class="header-anchor">#</a> 3.2 BeanDefinition</h3> <p>文档中提到：在容器本身中，这些Bean定义被表示为 <code>BeanDefinition</code> 对象，它包含（除其他信息外）以下元数据。</p> <ul><li>一个全路径类名：通常，被定义的Bean的实际实现类。</li> <li>Bean的行为配置元素，它说明了Bean在容器中的行为方式（scope、生命周期回调，等等）。</li> <li>对其他Bean的引用，这些Bean需要做它的工作。这些引用也被称为合作者或依赖。</li> <li>要在新创建的对象中设置的其他配置设置—例如，pool的大小限制或在管理连接池的Bean中使用的连接数。</li></ul> <p>文中并没有提到太多内容，可以知道的是，我们提供的配置最终被解析到了这里</p> <p>而至于类中每个变量对应哪个配置，或者说每个变量如何配置，计划等到注解时再来一一核对</p> <h2 id="四、ioc过程"><a href="#四、ioc过程" class="header-anchor">#</a> 四、IoC过程</h2> <p>结合文档学习后，对IoC已经有了一定理解，是时候从入口着手研究整个流程了，带上问题开始调试</p> <p>{% notel red IoC容器到底是怎么创建bean的？ %}</p> <p>通过前面的简单了解，我们知道了IoC容器的数据结构，也知道配置最终解析成了BeanDefinition，那么实例是如何创建的呢？ApplicationContext、BeanFactory这些类又是做什么的呢？</p> <p>{% endnotel %}</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BeanDefinitionTests</span> <span class="token punctuation">{</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token function">xmlTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">xmlTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">ClassPathXmlApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;spring.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">UserService</span> userService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token string">&quot;userService&quot;</span><span class="token punctuation">,</span> <span class="token class-name">UserService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		userService<span class="token punctuation">.</span><span class="token function">queryUser</span><span class="token punctuation">(</span><span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>从<code>ApplicationContext</code>入手，两行代码就从配置文件变成了实例对象，那么IoC的过程肯定也就在这两行中</p> <p>进入<code>ApplicationContext</code>的源码，发现很多都是调用了<code>BeanFactory</code>的实现，可以理解为<code>ApplicationContext</code>基于<code>BeanFactory</code>的能力进行了扩展</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2023/12/28 20:27:28</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/md/spring/spring-framework/2023-11-14-1-前言&amp;环境构建.html" class="prev">
        第一章、spring framework源码环境
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.85ba2fc4.js" defer></script><script src="/assets/js/2.a518c566.js" defer></script><script src="/assets/js/1.b931f3c5.js" defer></script><script src="/assets/js/40.1d2b5a3c.js" defer></script>
  </body>
</html>
